---
{"dg-publish":true,"permalink":"/4-computer/4-operating-system/2-unraid/1-embrace-unraid/"}
---

# 碎碎念
- 我是 21 年入坑的 NAS，当时想要构筑自己的信息堡垒，NAS 应该是比较小众的东西，当时绿联和极空间还达不到可用的程度，也只有群晖和威联通可以称为品牌 NAS，群晖的溢价上天了，威联通显的有性价比，但和 PC 一比溢价还是太高，而且硬件过于羸弱，虽然有一部分的钱是为软件付费比如系统、移动端，但是等我上手了之后发现很多功能都有开源的替代，没有舍其不能的功能，实在不行还可以黑个系统用。而且这样绑定硬件的软件，类比手机系统，应该没多少人会为系统付高额费用吧。
- 说起来惭愧，我一个计算机专业的在入坑的第一时间不是想着自组 NAS 也确实是没学好。NAS 并不神秘，也许觉得 Linux 高大上但是也有 Windows 的方案，部署很难但是有和安装 APP 一样的 Dokcker，看成一台电脑即可。我的第一个 NAS 威联通 453Dmini 很快就觉得不太顺眼，塑料空壳放大硬盘声音，一个风扇硬盘温度堪忧，不能使用 m.2 固态，文件路径冗长，大多数功能本就是开源项目提供的还得命令行敲命令为何不直接装 Linux 发行版呢，总之不自由。也建议想折腾的直接自建。
- 最后因为[硬盘聚合](https://www.jackiewu.top/article/why-unraid-cpu-overloaded-when-downloading-or-writing-files)的优势选择了 Unraid，相比工业场景，家庭使用也确实需要一定的适配。
# 硬件规划
- 玩 NAS 离不开机械硬盘，首先淘汰不适用一般家庭环境的机架式机箱，选择多盘位机箱或专门的 NAS 机箱，它们的主要区别就是支不支持硬盘热插拔，但是这项功能家庭使用聊胜于无，可有的选择也不多，规划一下需求找个顺眼的便宜的就行。
- 其他的一般配件直接用家用端的即可，如有需要可以买 sata 扩展，网卡之类。
## 磁盘规划
- 最重要的磁盘规划，Unraid 有 Array 和 Pool 的概念，Array 中可以设置
- Unraid 在 6.12 版本的更新中增加了对 ZFS 文件系统的支持，在这之前 ZFS 在这小圈子里算是备受推崇，但是我在自己的威联通尝试过 RAID5，对个人来说阵列也有它的缺陷
	1. 功耗：RAID 将几块硬盘汇成了一个整体，读写时这几块硬盘都是活动的，休眠是不用想了，而且不是待机的话功耗估计得有 10w？
	2. 冗余问题：企业环境中数据的价值要大于硬盘的价值，用更高级的 raid，热备更多的硬盘。家用 RAID5 如果重建，长时间的读写可能会导致剩下的盘出问题而彻底的丢失数据，司波图建议如果遇到 raid degraded 直接买回原 RAID 磁盘数量把数据复制进去
	3. 扩展问题：企业环境中设计方案，再配够硬盘即可，但是像我这样的使用场景，边学边规划，钱不够配齐硬盘，需要后期修改的机会，raid 通过替换更大容量的硬盘实现扩容就是一种高强度的重建啊，容易遇到上面提到过的问题。而增加盘位扩容更是需要购买齐目标方案的硬盘进行迁移，原来的硬盘又空出来了。总之家用的 raid 总觉得不对劲，当然 zfs 除了单盘扩容还提供了池扩容先 3 块组 z1，后期再扩容一组 z1，但是这样只是扩容了容量而且损失了两块的空间且只能每 vdev 冗余一块，即如果运气不好，一组 z1 中坏了两块就全寄了
- ok，那么，因为我现在设备是已经组好了，五月份的时候知道了 xl3 这个机箱感觉完美，不得不说老鸽的视频剪辑能力风格真是有水平，但是到手感觉有点拉垮应该不会再买这类个人设计的产品了，也够用了嘛，说回来，如果还没买设备应该怎么设计来发挥 unraid 的特性呢？
	- 速度问题，目前的主板即使是 w680 这种工作站主板自带的网口也只是 2.5G，而家用的路由器更是两个 2.5G 即是卖点，就是配交换机也是 2.5G 还能买到，想要再提升网速的话基本要大换血，光纤？万兆网卡？总之 2.5G 就是目前家用网速的一般上限了。规划硬盘也尽量把这速度利用起来吧，2.5G 除以 8，312.5MB 的理论传输速度，一块 PCIe 3.0 的固态比如[铠侠 RC20 1TB 版本即使是缓外读写也有750MB](https://www.bilibili.com/video/BV1R14y1f7ex/?spm_id_from=333.337.search-card.all.click&vd_source=0e8d5a2d613f40b7bb080c0607a88b1e)，企业级的机械硬盘比如[希捷银河 X18、西数 H550 平均读写速度达到了 210MB 左右](https://www.bilibili.com/video/BV1U8411G7Es/?spm_id_from=333.337.search-card.all.click&vd_source=0e8d5a2d613f40b7bb080c0607a88b1e)，可以跑满 2/3 的带宽，组一个三盘位的 raid5(3 倍速度) 或者 raid z1(两倍速度)都可以跑慢 2.5G，因为双盘的话 raid1 没写加速 raid0 没安全性，raid1 两块固态又太浪费了，在这样要求速度的条件应该是剪辑视频大文件读写也用不到固态的随读能力。那就是放三块盘到 cache 里组一个 zpool 利用起来
		- 因为 unraid 的特性，固态硬盘如果放入 array 无法自动 trim(一种删除文件空间回收功能)
# 文件夹规划
- 一般的缓存机制应该是把常用的文件放入速度更快的缓存来达到加速的作用，但是 unraid 是对整个共享文件夹进行设置，实际的文件位置以 mover action 划分，但是即使是同一个文件夹，里面的文件也会有的常用有的不常用啊，这应该算是一种误导吧，不过相对 array 里的单盘读写性能，如果用固态组的。array 和 pool(cache) 应该是平级的。刚刚在群里问了一下，缓存这个名字确实有误导的作用，叫暂存更合适。

> [!quote] [Unraid 上 Nextcloud 的部署问题 | 治部少辅](https://www.codewoody.com/posts/4155/)
> 在 Unraid 中，这个进程负责将分散在各个 Disk 上的文件夹内容聚合成一个统一的目录库，这意味着如果我们要访问任何文件都需要通过 shfs 来查找文件，这也使得 shfs 成文高吞吐率场景下的一个性能瓶颈。

- array 中的校验盘我还是要设置一个来提供一些保护，也因此 array 和目前有的 rack 池有所不同，文件夹需要原子化一些，也就是电影电视剧照片图片等在 453Dmini 中归到了 multimedia 文件夹中


因为电信宽带封禁了 80 和443 这两个网页端口，我想让路由器 NPM 监听 80 和 443在网址后添加 8167，然后路由器转发至服务器 Tower 的 80 端口，NPM 监听 80 端口再把这个请求发给 Tower 上的真正服务端口，到这流程应该都是对的，但是尝试访问后，返回的网址被去掉了后缀端口，

代理和转发还是有区别的
不对，好像是 unraid 的问题

丢失端口
[【求助】npm远程访问unraid时无法显示阵列、磁盘、cpu、内存、接口等信息。 - Chinese / 简体中文 - Unraid](https://forums.unraid.net/topic/139336-%E3%80%90%E6%B1%82%E5%8A%A9%E3%80%91npm%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AEunraid%E6%97%B6%E6%97%A0%E6%B3%95%E6%98%BE%E7%A4%BA%E9%98%B5%E5%88%97%E3%80%81%E7%A3%81%E7%9B%98%E3%80%81cpu%E3%80%81%E5%86%85%E5%AD%98%E3%80%81%E6%8E%A5%E5%8F%A3%E7%AD%89%E4%BF%A1%E6%81%AF%E3%80%82/#comment-1262738)


unraid connect


Initial Nextcloud username: **admin**  
Initial Nextcloud password: **9af13e8ccff127e7796f273ed438bda791aea71cd9d09c09**


[修改nextcloud上传大小限制-腾讯云开发者社区-腾讯云](https://cloud.tencent.com/developer/article/2235965)
