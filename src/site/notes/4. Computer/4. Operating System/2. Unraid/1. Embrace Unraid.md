---
{"dg-publish":true,"permalink":"/4-computer/4-operating-system/2-unraid/1-embrace-unraid/"}
---

# 碎碎念
- 我是 21 年入坑的 NAS，想要构筑自己的信息堡垒。NAS 应该是比较小众的东西，当时绿联和极空间还达不到可用的程度，只有群晖和威联通可以称为品牌 NAS，群晖高价低配是出了名的，威联通显的有点性价比，但和 PC 市场的硬件价格一比溢价还是太高，虽然有一部分的钱是为软件付费比如系统、移动端，但是等我上手了之后发现很多功能都有免费的替代或者干脆是开源软件，也没有舍其不能影响使用的功能，实在不行还有黑个系统用的方案。说回来这样绑定硬件的软件，类比手机系统，应该没多少人愿意为系统付高额费用吧。
- 说起来惭愧，我一个计算机专业的在入坑的第一时间不是想着自组 NAS 也确实是没学好。NAS 并不神秘，也许觉得 Linux 高大上但是也有 Windows 的方案，部署很难但是有和安装 APP 一样的 Dokcker，把 NAS 看成一台普通电脑即可，相反想通过打包好的品牌 NAS 而略去一些基础知识的学习也会在后期遇到问题时偿还。不过我的第一个 NAS 也是选择了威联通的 453Dmini ，跟着教程走一遍，配置完后没多久就觉得不自由不能随意折腾，硬件配置不允许啊，再比如塑料空腔放大硬盘读写声音，一个风扇硬盘温度堪忧，没有 m.2 插槽，挂载文件路径冗长，大多数功能本就是开源项目提供的还得命令行敲命令为何不直接装 Linux 发行版呢。建议以折腾为目的考虑自建。
- 最后因为[硬盘聚合](https://www.jackiewu.top/article/why-unRAID-cpu-overloaded-when-downloading-or-writing-files)的优势选择了 UnRAID 作为底层系统，相比工业场景，家庭使用也确实需要一定的适配。
# 硬件规划
- 玩 NAS 离不开机械硬盘，机箱需要提供足够多的硬盘位，首先淘汰不适用一般家庭环境的机架式机箱，选择多盘位机箱或专门的 NAS 机箱，它们的主要区别就是是否支持硬盘热插拔，但这项功能家庭使用其实聊胜于无，关个机拆了换一下也没啥问题。机箱可选范围也不多，小众产品的溢价也高，挑个便宜的好看的就行了。
	- 五月份的时候知道了 xl3 这个机箱感觉完美，不得不说老鸽的视频剪辑能力真是有水平，但是到手的做工、细节感觉有点拉垮，这种个人设计的产品确实很难像普通大厂的机箱这么完善。
- 其他的一般配件直接用桌面端的即可，如有需要再另购 sata 扩展、网卡之类。
## 磁盘规划
- 最重要的磁盘规划，UnRAID 有 Array 和 Pool 的概念，Array 中可以设置 Parity 来实现类似 RAID 的丢盘不丢数据的效果，又因为 Array 只能提供单盘读写速度而提供 Cache 的方案让用户将数据暂存在固态。
	- 固态硬盘如果放入 array 无法自动 trim(一种删除文件空间回收功能)
- 先说说 RAID ，UnRAID 在 6.12 版本的更新中增加了对 ZFS 文件系统的支持，在这之前 ZFS 在这小圈子里算是备受推崇，ZFS 也提供 RAID Z 方案，我在自己的威联通尝试过传统的 RAID5，有几个小问题
	1. 待机：RAID 将几块硬盘汇成了一个整体，读写时这几块硬盘都是活动的，首先是增加了功耗，其次是多盘的同时读写会导致噪音的增大。
	2. 冗余：企业环境中数据的价值要大于硬盘的价值，用更高级的 RAID，热备更多的硬盘。家用 RAID5 不建议重建，重建过程中的高强度读写可能会导致剩下的盘出问题而彻底的丢失数据，司波图建议如果遇到 degraded 直接买回原 RAID 磁盘数量把数据写入。
	3. 扩展：企业环境中钱够，设计好方案，再配够硬盘即可，但是像我这样的使用场景，边学边规划，钱也不够配齐硬盘，需要后期修改的机会。RAID 的几种扩容方式：
		1. 用大容量硬盘替换小容量，每一块替换都是一种重建
		2. 增加盘位扩容成员(RAID Z 不支持)，硬盘更多应该考虑更高级的 RAID 方案
		3. 购买齐目标方案的硬盘进行迁移，原来的硬盘空出来了
		4. RAID Z 还提供了池扩容，但是比如先 3 块组 z1，后期再扩容一组 z1，这样只是扩容了容量而且损失了两块的空间且只能每 vdev 冗余一块，即如果运气不好，一组 z1 中坏了两块就损失了所有数据
- 家用条件下的 RAID 总觉得不完美，有些局限，辩证的去看待。那就我个人来说重要数据必须有校验，还想要能跑满 2.5G 的内网，那 RAID 也必须得有了，RAID Z 相比软 RAID 更强大，因此我配置了四块盘 RAID Z1 作为 Cache Pool。Array 如果没有 Parity 和其他 Pool 也是平级的，现在 Cache 有校验冗余可以替代掉 Array 了。
> [!info]
> 2.5G 就是几年内家用网速的上限， 2.5Gbps 理论速度312.5MB/s，一块 PCIe 3.0 的固态比如[铠侠 RC20 1TB 版本即使是缓外读写也有750MB](https://www.bilibili.com/video/BV1R14y1f7ex/?spm_id_from=333.337.search-card.all.click&vd_source=0e8d5a2d613f40b7bb080c0607a88b1e)，企业级的机械硬盘比如[希捷银河 X18、西数 H550 平均读写速度达到了 210MB 左右](https://www.bilibili.com/video/BV1U8411G7Es/?spm_id_from=333.337.search-card.all.click&vd_source=0e8d5a2d613f40b7bb080c0607a88b1e)，可以跑满 2/3 的带宽，组一个三盘位的 RAID5(3 倍速度) 或者 RAID z1(两倍速度)都可以吃满带宽。

> [!info]
> Cache /kæʃ/ 被译为缓存，群晖的缓存方案类似内存设置为缓存的固态不是存储池的一部分，威联通的缓存是存储池的一部分常用的文件会被自动移到固态中，固态需要额外的冗余保障，而 Unraid，Unraid 的 Cache 是一个 pool 的名字而不是特定的功能，与其他的 pool 平级，功能上先利用这个池中的高速硬盘写入在闲时放入目标硬盘，译为暂存可能更合适，而且解决了写入，读出依旧是目标硬盘嘞。

# 文件夹规划

> [!quote] [UnRAID 上 Nextcloud 的部署问题 | 治部少辅](https://www.codewoody.com/posts/4155/)
> 在 UnRAID 中，这个进程负责将分散在各个 Disk 上的文件夹内容聚合成一个统一的目录库，这意味着如果我们要访问任何文件都需要通过 shfs 来查找文件，这也使得 shfs 成文高吞吐率场景下的一个性能瓶颈。

- array 中的校验盘我还是要设置一个来提供一些保护，也因此 array 和目前有的 rack 池有所不同，文件夹需要原子化一些，也就是电影电视剧照片图片等在 453Dmini 中归到了 multimedia 文件夹中


因为电信宽带封禁了 80 和443 这两个网页端口，我想让路由器 NPM 监听 80 和 443在网址后添加 8167，然后路由器转发至服务器 Tower 的 80 端口，NPM 监听 80 端口再把这个请求发给 Tower 上的真正服务端口，到这流程应该都是对的，但是尝试访问后，返回的网址被去掉了后缀端口，

代理和转发还是有区别的
不对，好像是 unRAID 的问题

丢失端口
[【求助】npm远程访问unRAID时无法显示阵列、磁盘、cpu、内存、接口等信息。 - Chinese / 简体中文 - UnRAID](https://forums.unRAID.net/topic/139336-%E3%80%90%E6%B1%82%E5%8A%A9%E3%80%91npm%E8%BF%9C%E7%A8%8B%E8%AE%BF%E9%97%AEunRAID%E6%97%B6%E6%97%A0%E6%B3%95%E6%98%BE%E7%A4%BA%E9%98%B5%E5%88%97%E3%80%81%E7%A3%81%E7%9B%98%E3%80%81cpu%E3%80%81%E5%86%85%E5%AD%98%E3%80%81%E6%8E%A5%E5%8F%A3%E7%AD%89%E4%BF%A1%E6%81%AF%E3%80%82/#comment-1262738)


unRAID connect


Initial Nextcloud username: **admin**  
Initial Nextcloud password: **9af13e8ccff127e7796f273ed438bda791aea71cd9d09c09**


[修改nextcloud上传大小限制-腾讯云开发者社区-腾讯云](https://cloud.tencent.com/developer/article/2235965)
